
def err():
    print("WRONG!!!")
    exit()
    

def pop():
    a = context[context[4]]
    context[4] += 1
    return a

def push(a):
    context[4] -= 1
    context[context[4]] = a

context = [0, 0, 0, 0, 999, 1000, 2000, 0] + [0xcc] * (1000 - 8) +[102, 183, 102, 76, 102, 117, 102, 205, 102, 98, 102, 170, 102, 7, 102, 228, 102, 116, 102, 225, 102, 72, 102, 205, 102, 256, 102, 135, 102, 247, 102, 68, 102, 178, 102, 28, 102, 241, 102, 126, 102, 45, 102, 170, 102, 38, 102, 134, 102, 95, 102, 53, 102, 237, 102, 148, 102, 237, 102, 242, 102, 100, 102, 28, 102, 35, 102, 254, 102, 80, 102, 223, 102, 64, 102, 53, 102, 101, 102, 164, 102, 10, 102, 193, 102, 140, 102, 207, 102, 33, 102, 168, 102, 62, 102, 74, 102, 121, 102, 151, 202, 0, 19, 0, 202, 0, 254, 0, 202, 0, 254, 0, 19, 0, 186, 0, 102, 170, 102, 175, 254, 0, 102, 186, 202, 0, 102, 237, 102, 235, 186, 0, 255, 0, 186, 0, 255, 0, 102, 229, 153, 0, 202, 0, 19, 0, 153, 0, 102, 216, 19, 0, 102, 114, 102, 144, 102, 13, 255, 0, 190, 0, 186, 0, 153, 0, 186, 0, 254, 0, 190, 0, 19, 0, 254, 0, 102, 233, 186, 0, 255, 0, 153, 0, 202, 0, 19, 0, 186, 0, 202, 0, 186, 0, 102, 128, 202, 0, 102, 6, 102, 109, 102, 0xffff, 254, 0, 55, 0, 105, 0, 190, 0, 153, 0, 202, 0, 102, 62, 186, 0, 19, 0, 186, 0, 102, 255, 102, 158, 254, 0, 153, 0, 202, 0, 202, 0, 19, 0, 102, 0, 102, 100, 102, 0xffff, 19, 0, 55, 0, 105, 0, 153, 0, 102, 132, 255, 0, 19, 0, 190, 0, 102, 220, 102, 70, 254, 0, 102, 54, 102, 229, 190, 0, 102, 54, 102, 135, 254, 0, 254, 0, 255, 0, 19, 0, 102, 28, 254, 0, 153, 0, 102, 106, 102, 0xffff, 254, 0, 55, 0, 105, 0, 102, 213, 19, 0, 255, 0, 102, 105, 255, 0, 186, 0, 202, 0, 255, 0, 186, 0, 102, 152, 102, 194, 102, 223, 255, 0, 202, 0, 202, 0, 153, 0, 153, 0, 254, 0, 102, 0xffff, 102, 6, 202, 0 , 55, 0, 105, 0, 19, 0, 102, 133, 254, 0, 254, 0, 255, 0, 186, 0, 202, 0, 19, 0, 254, 0, 254, 0, 19, 0, 255, 0, 153, 0, 254, 0, 102, 0xffff, 102, 561, 190, 0, 102, 8, 186, 0, 55, 0, 105, 0, 102, 144, 102, 224, 186, 0, 202, 0, 19, 0, 254, 0, 102, 31, 102, 166, 102, 212, 19, 0, 254, 0, 102, 209, 153, 0, 102, 205, 102, 145, 254, 0, 186, 0, 254, 0, 102, 169, 186, 0, 254, 0, 102, 116, 102, 117, 102, 211, 19, 0, 190, 0, 102, 51, 254, 0, 102, 0xffff, 55, 0, 105, 0, 102, 0, 190, 0, 190, 0, 254, 0, 102, 53, 19, 0, 186, 0, 190, 0, 254, 0, 186, 0, 190, 0, 102, 77, 102, 132, 255, 0, 186, 0, 153, 0, 153, 0, 102, 15, 202, 0, 102, 0xffff, 55, 0, 105, 0, 102, 27, 186, 0, 186, 0, 102, 54, 102, 125, 190, 0, 202, 0, 153, 0, 153, 0, 102, 233, 19, 0, 102, 149, 102, 231, 254, 0, 102, 106, 19, 0, 102, 0xffff, 55, 0, 105, 0, 102, 68, 202, 0, 102, 152, 254, 0, 19, 0, 186, 0, 255, 0, 19, 0, 202, 0, 255, 0, 153, 0, 254, 0, 186, 0, 19, 0, 202, 0, 19, 0, 255, 0, 186, 0, 255, 0, 19, 0, 202, 0, 102, 97, 102, 242, 19, 0, 153, 0, 202, 0, 202, 0, 186, 0, 202, 0, 255, 0, 190, 0, 202, 0, 254, 0, 254, 0, 255, 0, 102, 114, 153, 0, 102, 4, 153, 0, 202, 0, 102, 218, 19, 0, 102, 12, 19, 0, 186, 0, 102, 70, 102, 86, 186, 0, 186, 0, 102, 17, 190, 0, 254, 0, 255, 0, 102, 172, 254, 0, 202, 0, 190, 0, 153, 0, 153, 0, 202, 0, 190, 0, 102, 162, 190, 0, 254, 0, 254, 0, 254, 0, 254, 0, 255, 0, 102, 179, 153, 0, 153, 0, 102, 133, 254, 0, 102, 36, 102, 119, 255, 0, 102, 14, 19, 0, 153, 0, 102, 221, 202, 0, 102, 139, 255, 0, 153, 0, 102, 187, 102, 237, 19, 0, 102, 77, 254, 0, 186, 0, 102, 103, 255, 0, 19, 0, 255, 0, 102, 193, 186, 0, 102, 139, 186, 0, 153, 0, 102, 183, 153, 0, 19, 0, 255, 0, 102, 58, 153, 0, 186, 0, 202, 0, 255, 0, 254, 0, 102, 252, 186, 0, 153, 0, 102, 84, 186, 0, 190, 0, 102, 155, 254, 0, 19, 0, 186, 0, 190, 0, 255, 0, 102, 90, 102, 231, 186, 0, 186, 0, 19, 0, 255, 0, 255, 0, 255, 0, 102, 121, 202, 0, 254, 0, 186, 0, 19, 0, 255, 0, 186, 0, 202, 0, 102, 1, 153, 0, 102, 129, 202, 0, 102, 216, 153, 0, 19, 0, 190, 0, 202, 0, 254, 0, 186, 0, 186, 0, 102, 156, 102, 44, 186, 0, 102, 101, 254, 0, 254, 0, 190, 0, 102, 121, 190, 0, 186, 0, 102, 224, 153, 0, 254, 0, 19, 0, 202, 0, 202, 0, 19, 0, 102, 88, 255, 0, 102, 46, 186, 0, 186, 0, 255, 0, 102, 126, 186, 0, 254, 0, 190, 0, 102, 39, 102, 33, 153, 0, 153, 0, 102, 41, 102, 35, 254, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0]+ [0xaa] * 100
# print(len(context))

print("Gimme a key")

# The length flag is 8
user_input = input("> ")

key = ""

for i in user_input:
    for k in range(0, len(context)):
        if context[k] == 0xffff:
            print(k)
            context[k] = ord(i)
            key += i
            break

# check key use vm-instruction
while (context[5] < 2000):
    # print(context[5])
    ins = context[context[5] : context[5] + 2]
    # print(ins) | ins []

    match ins[0]:
        case 0xff:
            pass
        case 0xca: #add
            a = pop()
            b = pop()
            push(a+b)
        
        case 0xfe: #sub
            a = pop()
            b = pop()
            push(a-b)
           
        case 0xba: #mul
            a = pop()
            b = pop()
            push(a*b)

        case 0xbe: #div
            a = pop()
            b = pop()
            push(a//b)
                
        case 0x13: #xor
            a = pop()
            b = pop()
            push(a^b)
        
        case 0x37: #cmp
            a = pop()
            b = pop()
            if (a == b):
                push(1)
            else:
                push(0)
        case 0x66: #push
            push(ins[1])
        
        case 0x99: #pop
            pop()
        
        case 0x69: #store
            a = pop()
            context[context[6]] = a
            context[6] += 1
            
        
        
    context[5] += 2


for i in range(2000, 2008):
    if context[i] != 1:
        err()
    

flag_encrypted = [53, 40, 42, 45, 72, 6, 42, 75, 66, 9, 27, 6, 0, 109, 3, 85, 44, 16, 3, 94, 71, 109, 24, 12, 24, 87, 24, 53, 71, 90, 70, 103, 23, 80, 18, 23]

flag = ""

for i in range(0, len(flag_encrypted)):
    flag +=  chr(flag_encrypted[i] ^ ord(key[i % len(key)]))

print("Congrat!!!")
print("This is your flag:")
print(''.join(flag))













